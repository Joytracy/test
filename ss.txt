import cx_Oracle
import pandas as pd

# 数据库连接字符串
connection_string1 = 'user1/password1@host1:port1/service_name1'
connection_string2 = 'user2/password2@host2:port2/service_name2'

# 连接到数据库
connection1 = cx_Oracle.connect(connection_string1)
connection2 = cx_Oracle.connect(connection_string2)

# 查询表结构
query = 'SELECT column_name, data_type FROM user_tab_columns WHERE table_name = :table_name'
table_name = 'YOUR_TABLE_NAME'
columns1 = pd.read_sql(query, params={'table_name': table_name}, con=connection1)
columns2 = pd.read_sql(query, params={'table_name': table_name}, con=connection2)

# 找到相同和不同的列
common_columns = pd.merge(columns1, columns2, on=['column_name', 'data_type'])
different_columns = pd.concat([columns1, columns2]).drop_duplicates(keep=False)

# 输出到 CSV
common_columns.to_csv('common_columns.csv', index=False)
different_columns.to_csv('different_columns.csv', index=False)

# 查询表数据
query1 = f'SELECT * FROM {table_name}'
query2 = f'SELECT * FROM {table_name}'
data1 = pd.read_sql(query1, con=connection1)
data2 = pd.read_sql(query2, con=connection2)

# 找到相同和不同的数据
common_data = pd.merge(data1, data2)
different_data1 = pd.concat([data1, data2]).drop_duplicates(keep=False)
different_data2 = pd.concat([data2, data1]).drop_duplicates(keep=False)

# 输出到 CSV
common_data.to_csv('common_data.csv', index=False)
different_data1.to_csv('different_data1.csv', index=False)
different_data2.to_csv('different_data2.csv', index=False)

# 关闭数据库连接
connection1.close()
connection2.close()
